<div class="p-6">
  <p-toast />

  <div class="mb-6 flex justify-between items-center">
    <div class="flex items-center gap-4">
      <p-button
        icon="pi pi-arrow-left"
        (onClick)="goBack()"
        severity="secondary"
        [text]="true"
      />
      <h1 class="text-3xl font-bold text-gray-800">User Management</h1>
    </div>
    <p-button
      label="Create User"
      icon="pi pi-plus"
      (onClick)="showCreateDialog()"
      severity="success"
    />
  </div>

  <div class="card">
    <p-table
      [value]="users"
      [loading]="loading"
      [paginator]="true"
      [rows]="10"
      [totalRecords]="totalRecords"
      [lazy]="true"
      (onLazyLoad)="onPageChange($event)"
      [tableStyle]="{'min-width': '60rem'}"
      styleClass="p-datatable-gridlines"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Email</th>
          <th>Name</th>
          <th>Role</th>
          <th>Tenant ID</th>
          <th>Created At</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-user>
        <tr>
          <td>{{ user.email }}</td>
          <td>{{ user.name }}</td>
          <td>
            <span
              [class]="user.role === 'ADMIN' ? 'px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium' : 'px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium'"
            >
              {{ user.role }}
            </span>
          </td>
          <td class="font-mono text-sm text-gray-600">{{ user.tenantId }}</td>
          <td>{{ formatDate(user.createdAt) }}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5" class="text-center py-8 text-gray-500">
            No users found
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Create User Dialog -->
  <p-dialog
    [(visible)]="displayDialog"
    [header]="'Create New User'"
    [modal]="true"
    [style]="{width: '450px'}"
    [draggable]="false"
    [resizable]="false"
  >
    <form [formGroup]="userForm" (ngSubmit)="createUser()">
      <div class="flex flex-col gap-4">
        <div class="flex flex-col gap-2">
          <label for="email" class="font-semibold">Email</label>
          <input
            pInputText
            id="email"
            formControlName="email"
            placeholder="user@example.com"
            class="w-full"
          />
          <small class="text-red-500" *ngIf="userForm.get('email')?.invalid && userForm.get('email')?.touched">
            Please enter a valid email address
          </small>
        </div>

        <div class="flex flex-col gap-2">
          <label for="name" class="font-semibold">Name</label>
          <input
            pInputText
            id="name"
            formControlName="name"
            placeholder="John Doe"
            class="w-full"
          />
          <small class="text-red-500" *ngIf="userForm.get('name')?.invalid && userForm.get('name')?.touched">
            Name is required
          </small>
        </div>

        <div class="flex flex-col gap-2">
          <label for="password" class="font-semibold">Password</label>
          <input
            pInputText
            type="password"
            id="password"
            formControlName="password"
            placeholder="Enter password"
            class="w-full"
          />
          <small class="text-red-500" *ngIf="userForm.get('password')?.invalid && userForm.get('password')?.touched">
            Password must be at least 6 characters
          </small>
        </div>

        <div class="flex flex-col gap-2">
          <label for="role" class="font-semibold">Role</label>
          <p-selectButton
            id="role"
            formControlName="role"
            [options]="roleOptions"
            optionLabel="label"
            optionValue="value"
          />
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <p-button
          label="Cancel"
          severity="secondary"
          (onClick)="hideDialog()"
          type="button"
        />
        <p-button
          label="Create"
          type="submit"
          [disabled]="userForm.invalid"
        />
      </div>
    </form>
  </p-dialog>
</div>
